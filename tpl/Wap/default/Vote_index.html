<!DOCTYPE html>
<html lang="en">
<head>
  <title>{gooraye:$vote.title}</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="description" content="{gooraye:$vote.title}">
<!-- 
<link href="{gooraye::STATICS}/vote/wap/css/custom.css?v=1.0.1" rel="stylesheet">
<link href="{gooraye::STATICS}/vote/wap/skins/all.css?v=1.0.1" rel="stylesheet"> -->
<link href="{gooraye::STATICS}/vote/wap/vote.css" rel="stylesheet">
<!--link href="{gooraye::STATICS}/vote/wap/vote.css" rel="stylesheet"-->
<script src="{gooraye::STATICS}/vote/wap/js/jquery.js"></script>
<!-- <script src="{gooraye::STATICS}/vote/wap/icheck.js?v=1.0.1"></script> -->
<script src="{gooraye::STATICS}/vote/wap/jquery.icheck.min.js"></script>
<style>#vote-img li {width: 50%;float: left;}
.votecontent .disabled{background: #a9a9a9;border-color: #a1a1a1;}

.beizhu {
    background-color: #FFF5C5;
    border: 1px solid #EDE17E;
    border-radius: 5px;
    box-shadow: 0 1px 1px #F6F6F6;
    color: #BCA24B;
    font-size: 14px;
    line-height: 22px;
    margin: 11px 0 8px;
    padding: 4px 10px 5px;
    text-align: center;
}

.deploy_ctype_tip{z-index:1001;width:100%;text-align:center;position:fixed;top:50%;margin-top:-23px;left:0;}.deploy_ctype_tip p{display:inline-block;padding:13px 24px;border:solid #d6d482 1px;background:#f5f4c5;font-size:16px;color:#8f772f;line-height:18px;border-radius:3px;}
.pxbtn{
  width: 100%;
}
</style>
</head>
<body id="vote-{gooraye:$vote['type']}" class="wrap" style="width:100%;margin:0 auto;">
<div class="vote">
  <div class="layout clear div_test">

      <div class="skin skin-line">
            <!--div class="skin-section"-->
            <div  class="votecontent">
            <h2>{gooraye:$vote.title}</h2>
              <span class="date">{gooraye:$vote.statdate|date="Y-m-d",###} / {gooraye:$vote.enddate|date="Y-m-d",###}</span>{gooraye:$vote['info']}
               <p class="modus">{gooraye:$vote['info']}</p>
         <br/>
               <if condition="($vote['picurl'] neq '') AND ($vote['showpic'] eq 1) ">
               <p><img src="{gooraye:$vote.picurl}" style="width:100%;" /></p>
               </if>

             <p class="modus"> <if condition="$vote['cknums'] eq 1"> 单选<else/>多选</if>投票，<span class="number">共有{gooraye:$count} 人参与投票</span></p>
       <br/>
<!--投票选项开始-->

        <ul class="list">
              <volist name="vote_item" id="li">
          <if condition="$vote['cknums'] eq 1"> <!--单选投票开始-->
          <if condition="$vote['type'] eq 'text'"> <!--单选 文字投票开始-->
              <li>     
                  <label for="square-checkbox-{gooraye:$i}">
                    <input tabindex="{gooraye:$i}" name="vid[]"   value="{gooraye:$li.id}" type="radio" id="square-checkbox-{gooraye:$i}" style="position: absolute; opacity: 0;">
                    <ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins><span>{gooraye:$li.item}</span></label>
                  <div id="voteshow{gooraye:$i}" class="votebar"><div class="pbg"><div style="width: {gooraye:$li.per|default=0}%;background-color:#ffcc00" class="pbr"></div></div><span class="percentage" style="color:#ffcc00">{gooraye:$li.per}%<span class="user">({gooraye:$li['pro']})</span></span>
                </div>
                  
              </li>
          <else/> 
          <!--单选 图片投票开始-->
                <li>
                   <label for="square-checkbox-{gooraye:$i}">
                    <a href="{gooraye:$li.tourl}"><img src="{gooraye:$li.startpicurl}" heigth="260" style="width:100%;max-height:720px;"></a>
                    <input tabindex="{gooraye:$i}" name="vid[]"   value="{gooraye:$li.id}" type="radio" id="square-checkbox-{gooraye:$i}" style="position: absolute; opacity: 0;">
                    <ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins><span>{gooraye:$li.item}</span></label>
                  <div id="voteshow{gooraye:$i}" class="votebar"><div class="pbg"><div style="width: {gooraye:$li.per|default=0}%;background-color:#ffcc00" class="pbr"></div></div><span class="percentage" style="color:#ffcc00">{gooraye:$li.per}%<span class="user">({gooraye:$li['pro']})</span></span>
                </div>

<!-- 
                    <span><a href="{gooraye:$li.tourl}"><img src="{gooraye:$li.startpicurl}" heigth="260" style="width:100%;max-height:720px;"></a></span>
                    <input tabindex="{gooraye:$i}" type="radio" name="vid" value="{gooraye:$li.id}" id="line-radio-{gooraye:$i}">
                    <label for="line-radio-{gooraye:$i}">{gooraye:$li.item}</label>
                    <div class="progress-bar orange shine">
                    <span style="width: {gooraye:$li.per|default=0}%">{gooraye:$li.per}%</span>&nbsp; &nbsp;<span>{gooraye:$li['pro']}(人)</span>
                    <div class="vote_result_meta vote_graph">
                <span style="width:{gooraye:$li.per|default=0}%;background-color:#<?php echo rand(100000,999999);?>" class="vote_progress"></span>
                </div>
                </div> -->
              </li>
          </if>


<else/><!--多选 投票开始-->
                    <if condition="$vote['type'] eq 'text'"><!--多选 文字投票开始-->
              <li>
                <label for="line-checkbox-{gooraye:$i}"><input class="ckbx" tabindex="{gooraye:$i}" name="vid[]" value="{gooraye:$li['id']}" type="checkbox" id="line-checkbox-{gooraye:$i}" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins><span>{gooraye:$li.item}</span></label>


                <!-- <div class="progress-bar orange shine">
                <span style="width: {gooraye:$li.per|default=0}%">{gooraye:$li.per}%</span>&nbsp; &nbsp;<span>{gooraye:$li['pro']}(人) </span>
                <div class="vote_result_meta vote_graph">
                <span style="width:{gooraye:$li.per|default=0}%;background-color:#<?php echo rand(100000,999999);?>" class="vote_progress"></span>
                </div>
                </div> -->
                
             </li>
          <else/> <!--多选 图片投票开始-->
                <li>
            
<label for="square-checkbox-{gooraye:$i}">
                    <a href="{gooraye:$li.tourl}"><img src="{gooraye:$li.startpicurl}" heigth="260" style="width:100%;max-height:720px;"></a>
                    <input tabindex="{gooraye:$i}" name="vid[]"   value="{gooraye:$li.id}" type="checkbox" id="square-checkbox-{gooraye:$i}" style="position: absolute; opacity: 0;">
                    <ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background-color: rgb(255, 255, 255); border: 0px; opacity: 0; background-position: initial initial; background-repeat: initial initial;"></ins><span>{gooraye:$li.item}</span></label>
                  <div id="voteshow{gooraye:$i}" class="votebar"><div class="pbg"><div style="width: {gooraye:$li.per|default=0}%;background-color:#ffcc00" class="pbr"></div></div><span class="percentage" style="color:#ffcc00">{gooraye:$li.per}%<span class="user">({gooraye:$li['pro']})</span></span>
                </div>


            <!--     <span><a href="{gooraye:$li.tourl}"><img src="{gooraye:$li.startpicurl}" heigth="260" style="width:100%;max-height:720px;" ></a></span>
               
                  <input tabindex="{gooraye:$i}" type="checkbox" name="vid" value="{gooraye:$li.id}"  id="line-checkbox-{gooraye:$i}">
                <label for="line-checkbox-{gooraye:$i}">{gooraye:$li.item}</label>
                <div class="progress-bar orange shine">
                 <span style="width: {gooraye:$li.per|default=0}%">{gooraye:$li.per}%</span>&nbsp; &nbsp;<span>{gooraye:$li['pro']}(人)</span>
                 <div class="vote_result_meta vote_graph">
                <span style="width:{gooraye:$li.per|default=0}%;background-color:#<?php echo rand(100000,999999);?>" class="vote_progress"></span>
                </div>
                </div> -->
              </li>
          </if>
  </if> <!--投票结束-->
                </volist>
      </ul>
           
     
        <?php          
          if($vote['enddate'] < time()){
        ?>
            <br/> 投票已经结束<br/>
         <?php               
          }elseif($vote['statdate'] > time()){
            echo " 投票还没正式开始";
          }else{
              if($vote_record == 1){ 
            ?>
                <a href="javascript:showTip('请不要重复投票');" class="pxbtn disabled">您已经投过票了</a>
                     <p class="beizhu" style="color: coral;">您投的是：<volist name="hasitems" id="vo">
                   {gooraye:$vo['item']},
                    </volist></p>
        <?php
          }else{
            ?>
         <input class="pxbtn" name="sub" id="sub" value="提交选票" type="submit">
        <?php
        }
       }
       ?>

         <br/><br/>
    </div>
</div>

</div>
</div>
<script>  $(document).ready(function(){
     $('.list input').each(function(){
       var self = $(this),
        label = self.next(),
        label_text = label.text();
        label.remove();
       self.iCheck({
         checkboxClass: 'icheckbox_flat',
         radioClass: 'iradio_flat',
         insert: '<div class="icheck_line-icon"></div>' + label_text
       });

    });

  $("#sub").bind("click",function(){

    var self = $(this);
    var chk = document.getElementsByName('vid[]');
    var objarray = chk.length;
    var chid = "";
    var wecha_id = "{gooraye:$Think.get.wecha_id}";
    var token  = "{gooraye:$Think.get.token}";
    var tid = "{gooraye:$Think.get.id}";

    for (i=0;i<objarray;i++)
    {
      if(chk[i].checked == true)
      {
         chid+=chk[i].value+",";
      }
    }

    if(wecha_id == ''){
      showTip("您可能是从分享页面打开的，请关注“{gooraye:$wxuser['weixin']}”然后发送关键词“投票”进行投票");
      return;
    }

    if(chid == ""){
      showTip("请选择投票的选项");
      return;
    }else{
        var submitData={
            wecha_id : wecha_id,
            tid      : tid,
            chid     : chid,
            token    : token,
            action   : "add_vote"
        };

        $.post('index.php?g=Wap&m=Vote&a=add_vote&token='+token+'&wecha_id='+wecha_id, submitData, function(backdata) {
          // console.log(backdata);
          // var obj=eval('('+backdata+')');
          // console.log(obj)
            showTip(backdata.info);
            setTimeout(function(){window.location.reload()},2000);
            return;
        },"json");
    }
  });

});

function showTip(tipTxt) {
  var div = document.createElement('div');
  div.innerHTML = '<div class="deploy_ctype_tip"><p>' + tipTxt + '</p></div>';
  var tipNode = div.firstChild;
  $(".wrap").after(tipNode);
  setTimeout(function () {
    $(tipNode).remove();
  }, 1500);
}
</script>
<script type="text/javascript">
window.shareData = {
            "moduleName":"Vote",
            "moduleID":"0",
            "imgUrl": "{gooraye:$vote.picurl}",
            "sendFriendLink": "{gooraye::C('site_url')}{gooraye::U('Vote/index',array('token'=>$token,'id'=>$id))}",
            "tTitle": "{{gooraye:$vote.title}",
            "tContent": "{gooraye:$vote['info']|html_entity_decode}"
        };
</script>
{gooraye:$user}
{gooraye:$shareScript}
</body>
</html>